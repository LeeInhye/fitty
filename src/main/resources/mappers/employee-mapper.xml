<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="employeeMapper">

<resultMap id="employeeResult" type="Employee">
		<result column="emp_no" property="empNo"/>
		<result column="emp_name" property="empName"/>
		<result column="emp_grade" property="empGrade"/>
		<result column="emp_gender" property="empGender"/>
		<result column="emp_mail" property="empMail"/>
		<result column="emp_phone" property="empPhone"/>
		<result column="emp_birth" property="empBirth"/>
		<result column="emp_photo" property="empPhoto"/>
		<result column="emp_enroll_date" property="empEnrollDate"/>
		<result column="emp_modify_date" property="empModifyDate"/>
</resultMap>

	<select id="loginEmployee" resultMap="employeeResult">
		select   emp_no
			   , emp_name
			   , emp_grade
			   , emp_gender
			   , emp_mail
			   , emp_phone
			   , emp_birth
			   , emp_status
			   , emp_photo
			   , emp_enroll_date
			   , emp_modify_date
		  from   tb_emp
		 where   emp_no = #{empNo} 
	</select>

	<select id="selectNextEmpNo" resultType="string">
		select last_number
		  from user_sequences
		 where sequence_name = 'seq_emp_no'
		<!-- SELECT LAST_NUMBER FROM USER_SEQUENCES WHERE SEQUENCE_NAME = 'SEQ_EMP_NO' -->
	</select>
	
	<insert id="insertEmployee">
		insert into tb_emp
		    (
		     emp_no
		   , emp_name
		   , emp_grade
		   , emp_gender
		   , emp_mail
		   , emp_phone
		   , emp_birth
		   , emp_status
		   , emp_photo
		   , emp_enroll_date
		   , emp_modify_date
		    )
		values
		    ( #{gradeString} || seq_emp_no.nextval
		   , #{empName}
		   , #{empGrade}
		   , #{empGender}
		   , lower(#{gradeString})|| seq_emp_no.CURRVAL || '@fitty.com'
		   , #{empPhone}
		   , #{empBirth}
		   , 'Y'
		   , #{empPhoto}
		   , sysdate
		   , sysdate
		     )
	</insert>
	
	<select id="selectEmpList" resultMap="employeeResult">
		select emp_no
			 , emp_name
			 , emp_grade
		  from tb_emp
		where emp_status = 'Y'
	</select>
	
	  <select id="selectEmpListCount" resultType="_int">
	  	select count(*)
	  	  from tb_emp
	  	 where emp_status = 'Y'
	  </select>
	  
	  <select id="selectLevelEmployeeList" resultMap="employeeResult">
		select 
		       LPAD('　　　', 2*(LEVEL-1)) || emp_name emp_name
		     , g.gr_name emp_grade
		     , emp_no
		  from tb_grade g
		  join tb_emp e on (e.emp_grade = g.emp_grade)
		 start with gr_pr_grade is null
	   connect
	   		by nocycle prior g.emp_grade = gr_pr_grade 
	  </select>
	  
	  
	  <select id="checkEmpNoList" resultMap="employeeResult">
		select e.emp_no
			 , e.emp_name
			 , g.gr_name emp_grade
		  from tb_emp e
		  join tb_grade g on (e.emp_grade = g.emp_grade)
		 where e.emp_no in ${empNo}
	  </select>
	  
	

</mapper>

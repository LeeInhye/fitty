<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="attendanceMapper">

<resultMap id="attendanceResult" type="Attendance">
		<result column="att_no" property="attNo"/>
		<result column="emp_no" property="empNo"/>
		<result column="att_date" property="attDate"/>
		<result column="att_in" property="attIn"/>
		<result column="att_out" property="attOut"/>
		<result column="att_status" property="attStatus"/>
		<result column="att_plus_work" property="attPlusWork"/>
		<result column="att_nwork_time" property="attNworkTime"/>
		<result column="att_pwork_time" property="attPworkTime"/>
</resultMap>
  
  <select id="selectAllAttList" resultMap="attendanceResult">
  	
  	select emp_no
  		 , att_date
  	     , att_status
  	  from tb_att
  	 where emp_no = #{empNo}
  	   and att_date BETWEEN TO_DATE('22/08/01', 'YY/MM/DD') 
                        AND TO_DATE('22/08/31', 'YY/MM/DD')
  	   
  </select>
  
  <insert id="insertAttendance">
  	DECLARE
	  date1 DATE := TO_DATE('20220101','yyyy-mm-dd');
	  date2 DATE := TO_DATE('20230101','yyyy-mm-dd');
	BEGIN
	  FOR i IN 1..(date2 - date1 + 1) LOOP
	   insert into tb_att ( att_no, emp_no, att_date, att_in, att_out, att_status, att_plus_work)
	   values (SEQ_ATT_NO.NEXTVAL, ${empNo}, (TO_CHAR(date1 + i - 1, 'yyyy-mm-dd')), null, null, ' ', 'N');
	  END LOOP;
	END;
  </insert>
  
  <update id="updateAttendanceStatus">
  <![CDATA[
  update tb_att
	set att_status = 'X'
	where emp_no =  ${empNo}
	  and att_date in 
	(select "att_date"
	   from(
	select level
	     , trunc(to_date('22/01/01', 'YY/MM/DD'), 'MM') + level -1 "att_date"
	     , to_char(trunc(to_date('22/01/01', 'YY/MM/DD'), 'MM') + level - 1 ,'DY') "요일"
	  from dual
	connect by level <= 365
	)
	where 요일 in ('월', '화', '수', '목', '금'))
  ]]>
  </update>


</mapper>
